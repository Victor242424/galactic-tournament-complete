<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo Galáctico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(130, 130, 130, 0.5); }
            50% { box-shadow: 0 0 40px rgba(130, 130, 130, 0.8); }
        }
        .glow {
            animation: pulse-glow 2s infinite;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-gray-900 to-slate-900 min-h-screen text-white">
    
    <header class="backdrop-blur-md border-b border-gray-500/30 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <h1 class="text-4xl font-bold text-center bg-gradient-to-r from-gray-400 via-green-500 to-blue-500 bg-clip-text text-transparent">
                Torneo Galáctico
            </h1>
            <p class="text-center text-gray-300 mt-2">Cada 500 años las especies envian a sus guerreros más poderosos a luchar entre sí frente al emperador</p>
        </div>
    </header>

    <div class="container mx-auto px-4 mt-6">
        <div class="flex flex-wrap gap-2 justify-center">
            <button onclick="mostrarSeccion('especies')" 
                    class="tab-btn px-6 py-3 rounded-lg bg-gray-600 hover:bg-gray-700 transition font-semibold">
                Especies
            </button>
            <button onclick="mostrarSeccion('combate')" 
                    class="tab-btn px-6 py-3 rounded-lg bg-gray-600 hover:bg-gray-700 transition font-semibold">
                Combate
            </button>
            <button onclick="mostrarSeccion('ranking')" 
                    class="tab-btn px-6 py-3 rounded-lg bg-gray-600 hover:bg-gray-700 transition font-semibold">
                Ranking
            </button>
            <button onclick="mostrarSeccion('historial')" 
                    class="tab-btn px-6 py-3 rounded-lg bg-gray-600 hover:bg-gray-700 transition font-semibold">
                Historial
            </button>
        </div>
    </div>

    <main class="container mx-auto px-4 py-8">
        
        <section id="especies" class="seccion">
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-6 border border-gray-500/30">
                    <h2 class="text-2xl font-bold mb-6 text-gray-300"><span class="text-blue-500 font-bold text-3xl">+</span> Registrar Nueva Especie</h2>
                    <form id="formEspecie" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nombre de la Especie</label>
                            <input type="text" id="nombre" required
                                   class="w-full px-4 py-3 rounded-lg bg-slate-800 border border-gray-500/50 focus:border-gray-500 focus:ring-2 focus:ring-gray-500 outline-none transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Nivel de Poder</label>
                            <input type="number" id="nivelPoder" required min="0"
                                   class="w-full px-4 py-3 rounded-lg bg-slate-800 border border-gray-500/50 focus:border-gray-500 focus:ring-2 focus:ring-gray-500 outline-none transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Habilidad Especial</label>
                            <textarea id="habilidadEspecial" required rows="3"
                                      class="w-full px-4 py-3 rounded-lg bg-slate-800 border border-gray-500/50 focus:border-gray-500 focus:ring-2 focus:ring-gray-500 outline-none transition resize-none"></textarea>
                        </div>
                        <button type="submit" 
                                class="w-full py-3 bg-gradient-to-r from-gray-600 via-green-600 to-blue-600 hover:from-gray-700 hover:via-green-700  hover:to-blue-700 rounded-lg font-bold text-lg transition transform hover:scale-105">
                            Registrar Especie
                        </button>
                    </form>
                </div>

                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-6 border border-gray-500/30">
                    <h2 class="text-2xl font-bold mb-6 text-gray-300">Especies Registradas</h2>
                    <div id="listaEspecies" class="space-y-3 max-h-[500px] overflow-y-auto">
                    </div>
                </div>
            </div>
        </section>

        <section id="combate" class="seccion hidden">
            <div class="max-w-4xl mx-auto">
                <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-8 border border-gray-500/30">
                    <h2 class="text-3xl font-bold mb-8 text-center text-gray-300">Arena de Combate</h2>
                    
                    <div class="mb-8 text-center">
                        <button onclick="combateAleatorio()" 
                                class="px-8 py-4 bg-gradient-to-r from-gray-600 via-blue-600 to-green-600 hover:from-gray-700 hover:via-blue-700 hover:to-green-700 rounded-lg font-bold text-xl transition transform hover:scale-105 glow">
                            Combate Aleatorio
                        </button>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 mb-8">
                        <div>
                            <label class="block text-lg font-medium mb-3">Combatiente 1</label>
                            <select id="especie1" 
                                    class="w-full px-4 py-3 rounded-lg bg-slate-800 border border-gray-500/50 focus:border-gray-500 outline-none">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-lg font-medium mb-3">Combatiente 2</label>
                            <select id="especie2" 
                                    class="w-full px-4 py-3 rounded-lg bg-slate-800 border border-gray-500/50 focus:border-gray-500 outline-none">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                    </div>

                    <button onclick="iniciarCombate()" 
                            class="w-full py-4 bg-gradient-to-r from-gray-600 via-green-600 to-blue-600 hover:from-gray-700  hover:via-green-700 hover:to-blue-700 rounded-lg font-bold text-xl transition transform hover:scale-105">
                        Iniciar Combate
                    </button>

                    <div id="resultadoCombate" class="mt-8 hidden">
                    </div>
                </div>
            </div>
        </section>

        <section id="ranking" class="seccion hidden">
            <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-8 border border-gray-500/30">
                <h2 class="text-3xl font-bold mb-8 text-center text-gray-300">Ranking Galáctico</h2>
                <div id="tablaRanking" class="overflow-x-auto">
                </div>
            </div>
        </section>

        <section id="historial" class="seccion hidden">
            <div class="bg-black/30 backdrop-blur-lg rounded-2xl p-8 border border-gray-500/30">
                <h2 class="text-3xl font-bold mb-8 text-center text-gray-300">Historial de Combates</h2>
                <div id="listaCombates" class="space-y-4 max-h-[600px] overflow-y-auto">
                </div>
            </div>
        </section>

    </main>

    <div id="toast" class="fixed bottom-4 w-full flex justify-center items-center transition-all transform hidden">
        <div class="inline-block bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg mx-auto text-white">
            <p id="toastMessage"></p>
        </div>
        
    </div>

    <script>
        const API_URL = 'http://localhost:8080/api';
        let especies = [];

        // Mostrar/Ocultar Secciones
        function mostrarSeccion(seccion) {
            document.querySelectorAll('.seccion').forEach(s => s.classList.add('hidden'));
            document.getElementById(seccion).classList.remove('hidden');
            document.getElementById(seccion).classList.add('slide-in');
            
            // Actualizar datos según la sección
            if (seccion === 'especies') cargarEspecies();
            if (seccion === 'combate') cargarSelectores();
            if (seccion === 'ranking') cargarRanking();
            if (seccion === 'historial') cargarHistorial();
        }

        // Toast Notifications
        function mostrarToast(mensaje, tipo = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastParent = toastMessage.parentElement;
            toastParent.classList.remove('bg-green-600');
            toastParent.classList.remove('bg-red-600');

            tipo === 'success' ? toastParent.classList.toggle('bg-green-600') : toastParent.classList.toggle('bg-red-600') ;

            toastMessage.textContent = mensaje;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // Registrar Especie
        document.getElementById('formEspecie').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                nombre: document.getElementById('nombre').value,
                nivelPoder: parseInt(document.getElementById('nivelPoder').value),
                habilidadEspecial: document.getElementById('habilidadEspecial').value
            };

            try {
                const response = await fetch(`${API_URL}/especies`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    mostrarToast('Especie registrada exitosamente');
                    e.target.reset();
                    cargarEspecies();
                } else {
                    mostrarToast('Error: Especie ya existe', 'error');
                }
            } catch (error) {
                mostrarToast('Error de conexión', 'error');
            }
        });

        // Cargar Especies
        async function cargarEspecies() {
            try {
                const response = await fetch(`${API_URL}/especies`);
                especies = await response.json();
                
                const lista = document.getElementById('listaEspecies');
                lista.innerHTML = especies.length === 0 
                    ? '<p class="text-gray-400 text-center py-8">No hay especies registradas</p>'
                    : especies.map(e => `
                        <div class="bg-slate-800/50 rounded-lg p-4 border border-gray-500/30 hover:border-gray-500 transition">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-bold text-lg text-gray-300">${e.nombre}</h3>
                                    <p class="text-sm text-gray-400 mt-1">${e.habilidadEspecial}</p>
                                </div>
                                <div class="text-right">
                                    <div class="bg-gray-600 px-3 py-1 rounded-full text-sm font-bold">
                                        ${e.nivelPoder}
                                    </div>
                                    <p class="text-xs text-gray-400 mt-2">
                                        ${e.victorias}V - ${e.derrotas}D
                                    </p>
                                </div>
                            </div>
                        </div>
                    `).join('');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Cargar Selectores de Combate
        async function cargarSelectores() {
            try {
                const response = await fetch(`${API_URL}/especies`);
                especies = await response.json();
                
                const opciones = especies.map(e => 
                    `<option value="${e.id}">${e.nombre} (${e.nivelPoder})</option>`
                ).join('');
                
                document.getElementById('especie1').innerHTML = '<option value="">Seleccionar...</option>' + opciones;
                document.getElementById('especie2').innerHTML = '<option value="">Seleccionar...</option>' + opciones;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Iniciar Combate
        async function iniciarCombate() {
            const especie1Id = document.getElementById('especie1').value;
            const especie2Id = document.getElementById('especie2').value;

            if (!especie1Id || !especie2Id) {
                mostrarToast('Selecciona ambos combatientes', 'error');
                return;
            }

            if (especie1Id === especie2Id) {
                mostrarToast('Selecciona especies diferentes', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/combates`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ especie1Id, especie2Id })
                });

                if (response.ok) {
                    const resultado = await response.json();
                    mostrarResultadoCombate(resultado);
                    mostrarToast('Combate completado');
                }
            } catch (error) {
                mostrarToast('Error en el combate', 'error');
            }
        }

        // Combate Aleatorio
        async function combateAleatorio() {
            try {
                const response = await fetch(`${API_URL}/combates/aleatorio`, {
                    method: 'POST'
                });

                if (response.ok) {
                    const resultado = await response.json();
                    mostrarResultadoCombate(resultado);
                    mostrarToast('Combate aleatorio completado');
                } else {
                    mostrarToast('Se necesitan al menos 2 especies', 'error');
                }
            } catch (error) {
                mostrarToast('Error en el combate', 'error');
            }
        }

        // Mostrar Resultado del Combate
        function mostrarResultadoCombate(resultado) {
            const div = document.getElementById('resultadoCombate');
            div.className = 'mt-8 bg-gradient-to-r from-gray-900/50 to-blue-900/50 rounded-xl p-6 border-2 border-gray-500 slide-in';
            div.innerHTML = `
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-4">Resultado del Combate</h3>
                    <div class="grid grid-cols-3 gap-4 items-center mb-6">
                        <div class="text-right">
                            <p class="text-xl font-bold text-gray-300">${resultado.especie1}</p>
                        </div>
                        <div class="text-left">
                            <p class="text-xl font-bold text-blue-300">${resultado.especie2}</p>
                        </div>
                    </div>
                    <div class="bg-black/40 rounded-lg p-4 mb-4">
                        <p class="text-lg"><span class="text-green-400 font-bold">Ganador:</span> ${resultado.ganador}</p>
                    </div>
                    <p class="text-gray-300">${resultado.resultado}</p>
                    <p class="text-xs text-gray-500 mt-4">${new Date(resultado.fecha).toLocaleString('es-ES')}</p>
                </div>
            `;
            div.classList.remove('hidden');
        }

        // Cargar Ranking
        async function cargarRanking() {
            try {
                const response = await fetch(`${API_URL}/ranking`);
                const ranking = await response.json();
                
                const tabla = document.getElementById('tablaRanking');
                if (ranking.length === 0) {
                    tabla.innerHTML = '<p class="text-gray-400 text-center py-8">No hay datos en el ranking</p>';
                    return;
                }
                
                tabla.innerHTML = `
                    <table class="w-full">
                        <thead class="bg-gray-900/50 border-b-2 border-gray-500">
                            <tr>
                                <th class="px-4 py-3 text-left">Pos</th>
                                <th class="px-4 py-3 text-left">Especie</th>
                                <th class="px-4 py-3 text-center">Poder</th>
                                <th class="px-4 py-3 text-center">Victorias</th>
                                <th class="px-4 py-3 text-center">Derrotas</th>
                                <th class="px-4 py-3 text-left">Habilidad</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${ranking.map((e, i) => `
                                <tr class="border-b border-gray-500/20 hover:bg-gray-900/30 transition">
                                    <td class="px-4 py-3">
                                        <span class="text-2xl">${i === 0 ? '🥇' : i === 1 ? '🥈' : i === 2 ? '🥉' : e.posicion}</span>
                                    </td>
                                    <td class="px-4 py-3 font-bold text-gray-300">${e.nombre}</td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="bg-gray-600 px-2 py-1 rounded-full text-sm">${e.nivelPoder}</span>
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="bg-green-600 px-3 py-1 rounded-full font-bold">${e.victorias}</span>
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="bg-red-600 px-3 py-1 rounded-full font-bold">${e.derrotas}</span>
                                    </td>
                                    <td class="px-4 py-3 text-sm text-gray-400">${e.habilidadEspecial}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Cargar Historial
        async function cargarHistorial() {
            try {
                const response = await fetch(`${API_URL}/combates`);
                const combates = await response.json();
                
                const lista = document.getElementById('listaCombates');
                lista.innerHTML = combates.length === 0
                    ? '<p class="text-gray-400 text-center py-8">No hay combates registrados</p>'
                    : combates.map(c => `
                        <div class="bg-slate-800/50 rounded-lg p-5 border border-gray-500/30 hover:border-gray-500 transition">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-center gap-3">
                                    <span class="text-gray-300 font-bold">${c.especie1}</span>
                                    <span class="text-blue-300 font-bold">${c.especie2}</span>
                                </div>
                                <span class="bg-green-600 px-3 py-1 rounded-full text-sm font-bold">
                                    ${c.ganador}
                                </span>
                            </div>
                            <p class="text-sm text-gray-400 mb-2">${c.resultado}</p>
                            <p class="text-xs text-gray-600">${new Date(c.fecha).toLocaleString('es-ES')}</p>
                        </div>
                    `).join('');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Inicializar
        mostrarSeccion('especies');
    </script>
</body>
</html>